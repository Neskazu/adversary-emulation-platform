# Описание Архитектуры Платформы

Данный документ содержит текстовое описание архитектуры полигона. Графические схемы расположены в отдельных файлах:
*   [Уровень 1: Context](Context_Architecture.md)
*   [Уровень 2: Container](Container_Architecture.md)
*   [Уровень 3: Component](Component_Architecture.md)

## 1. Context (Контекст системы)

**Adversary Emulation Platform** представляет собой изолированный виртуальный полигон, предназначенный для проведения киберучений (Purple Teaming).

*   **Пользователи**: Исследователи безопасности, операторы Red Team и Blue Team.
*   **Основная функция**: Предоставить среду для безопасного запуска реальных техник атак (на базе MITRE ATT&CK) и отработки методов их обнаружения.
*   **Взаимодействие**: Пользователь разворачивает стенд через Vagrant, управляет атаками через веб-интерфейс Caldera и анализирует события в Kibana.

## 2. Container (Контейнеры и инфраструктура)

Система разделена на три изолированных сетевых сегмента, имитирующих реальную инфраструктуру предприятия и внешнего злоумышленника.

### Сетевые сегменты
1.  **Attacker Network (192.168.60.0/24)**:
    *   Зона ответственности Red Team.
    *   Содержит C2 сервер (Caldera).
2.  **Corporate Network (192.168.50.0/24)**:
    *   Зона ответственности Blue Team / IT.
    *   Имитирует офисную сеть с доменной структурой.
    *   Содержит контроллер домена (DC) и рабочие станции (WS01).
3.  **SIEM Network (192.168.70.0/24)**:
    *   Зона мониторинга.
    *   Сюда стекаются все логи для анализа.
    *   Содержит компоненты Elastic Stack.

### Основные компоненты
*   **Router**: Виртуальная машина на базе Linux, выполняющая роль шлюза между сетями. Настроена маршрутизация и правила firewall (iptables) для изоляции сегментов.
*   **Caldera Server**: Центральный сервер управления атаками (C2). Запускает "операции" (Operations), состоящие из цепочек "способностей" (Abilities).
*   **Elastic Stack (ELK)**:
    *   **Fleet Server**: Управляет агентами на хостах.
    *   **Logstash**: Принимает логи, парсит их и обогащает данными.
    *   **Elasticsearch**: База данных для хранения событий.
    *   **Kibana**: Интерфейс для визуализации и поиска (Threat Hunting).
*   **Agents**:
    *   **Caldera Agent (Sandcat)**: Легковесный агент, имитирующий поведение трояна/импланта. Получает инструкции от C2 сервера.
    *   **Elastic Agent + Sysmon**: Сборщики телеметрии. Sysmon генерирует детальные события (создание процессов, сетевые соединения), Elastic Agent отправляет их в SIEM.

## 3. Component (Компоненты Caldera Server)

Детализация внутренней структуры сервера Caldera, так как это ключевой инструмент эмуляции.

*   **Core System**:
    *   **Web Server / REST API**: Точка входа для оператора и API для автоматизации.
    *   **Data Service**: Центральное хранилище состояния (операции, агенты, результаты). Работает в памяти с периодическим сбросом в YAML файлы.
    *   **Contact Service**: Отвечает за коммуникацию с агентами. Поддерживает различные протоколы (HTTP, TCP, UDP).
    *   **Planning Service**: Логическое ядро, определяющее, какую следующую команду (Link) отправить агенту на основе фактов, полученных от предыдущих команд.
*   **Plugins**:
    *   **Stockpile**: База знаний техник (Abilities) и профилей атакующих (Adversaries).
    *   **Sandcat**: Реализация логики стандартного агента (Beacon), работающего через HTTP(S).
